<% layout("/layouts/boilerplate") %>
  <%- include('../partials/flash.ejs') %>

    </head>
    <style>
      .btn-styling {
        background-color: #fe424d !important;
        border: none !important;
      }
    </style>

    <body>
      <div class="row">
        <div class="col-8 offset-2">
          <form method="POST" action="/listing/<%= listing._id %>?_method=PUT" enctype="multipart/form-data"
            class="needs-validation" novalidate>
            <h3>Edit Your Listing</h3>

            <!-- Title -->
            <div class="mb-3">
              <label class="form-label" for="title">Title</label>
              <input name="title" value="<%= listing.title %>" required class="form-control" type="text"
                placeholder="Enter title">
              <div class="invalid-feedback">Please provide a title.</div>
              <div class="valid-feedback">Looks good!</div>
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label class="form-label" for="description">Description</label>
              <textarea name="listing[description]" required class="form-control"
                placeholder="Enter description"><%= listing.description %></textarea>
              <div class="invalid-feedback">Please provide a description.</div>
              <div class="valid-feedback">Looks good!</div>
            </div>

            <!-- image-preview -->
            <% if (transformedImageUrl) { %>
              <img src="<%= transformedImageUrl %>" alt="<%= listing.title %>" class="mt-2" />
              <% } %>
              
                <!-- Image -->
                <div class="col-md-12">
                  <label class="form-label" for="image">Upload Listing Image</label>
                  <input name="listing[image]" class="form-control" id="image" type="file" accept="image/*">
                  <div class="invalid-feedback">Please upload a valid image.</div>
                  <div class="valid-feedback">Image uploaded successfully!</div>
                </div>


                <!-- Price & Country -->
                <div class="row">
                  <div class="mb-3 col-md-4">
                    <label class="form-label" for="price">Price</label>
                    <input name="listing[price]" value="<%= listing.price %>" required class="form-control"
                      type="number" placeholder="Price">
                    <div class="invalid-feedback">Please provide a valid price.</div>
                    <div class="valid-feedback">Looks good!</div>
                  </div>

                  <div class="mb-3 col-md-8">
                    <label class="form-label" for="country">Country</label>
                    <input name="listing[country]" value="<%= listing.country %>" required class="form-control"
                      type="text" placeholder="Enter country">
                    <div class="invalid-feedback">Please provide a valid country.</div>
                    <div class="valid-feedback">Looks good!</div>
                  </div>
                </div>

                <!-- City -->
                <div class="mb-3">
                  <label class="form-label" for="location">City</label>
                  <input name="listing[location]" value="<%= listing.location %>" required class="form-control"
                    type="text" placeholder="Enter city">
                  <div class="invalid-feedback">Please provide a valid city.</div>
                  <div class="valid-feedback">Looks good!</div>
                </div>

                <!-- Submit -->
                <br>
                <button class="btn btn-dark btn-styling">Update</button>
          </form>
          <br><br>
        </div>
      </div>

      <script>
        // Bootstrap validation
        (function () {
          'use strict'
          const forms = document.querySelectorAll('.needs-validation')
          Array.from(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
              if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
              }
              form.classList.add('was-validated')
            }, false)
          })
        })()
      </script>
    </body>